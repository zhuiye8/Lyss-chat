### **Lyss AI Platform \- 最终开发蓝图 (Final Development Blueprint)**

版本：1.0  
状态：已确认，准备开发

#### **第一部分：项目愿景与核心业务**

1.1. 平台定位  
Lyss AI Platform 是一个企业级的AI服务聚合与管理平台，采用微服务架构，旨在为多租户环境提供统一的AI模型集成、智能路由和成本管控解决方案。  
**1.2. 核心目标**

* **统一接入**: 为用户提供单一入口，访问和管理来自不同供应商的AI服务。  
* **成本管控**: 提供精细化的用量跟踪、成本核算与配额管理功能。  
* **协作共享**: 通过灵活的群组和权限体系，支持团队内部的AI资源共享与协作。

#### **第二部分：功能规格说明**

**2.1. 用户与群组体系**

* **2.1.1. 平台级角色**  
  * **用户 (User)**: 系统的基础单位，通过开放的邮箱服务进行注册。  
  * **超级管理员 (Super Admin)**: 系统中唯一的最高权限管理者。  
* **2.1.2. 群组创建**  
  * 任何用户均可创建群组，默认上限为3个。  
  * 超级管理员有权调整任何用户的“群组创建数量上限”。  
* **2.1.3. 群组内角色与权限**

| 角色 | 权限描述 |
| :---- | :---- |
| **群主 (Owner)** | \- 群组的创建者，群内唯一。 \- **管理权限**: 任命/撤销管理员、转让群主身份、解散群组。 \- **配置权限**: 拥有管理员的所有配置权限。 |
| **管理员 (Admin)** | \- 可由群主任命，群内可有多个。 \- **成员管理**: 邀请新成员、审批加入申请。 \- **资源管理**: 为群组配置供应商凭证、向成员分发具体模型的使用权限。 |
| **成员 (Member)** | \- 群组的基础用户。 \- **使用权限**: 使用被管理员分配的群组AI模型服务。 |

* **2.1.4. 成员生命周期**  
  * **加入**: 通过管理员邀请或用户搜索群组ID/浏览公开列表后申请加入，由管理员审批。  
  * **离开**: 成员或管理员可自由离开群组，离开后所有与该群组相关的权限立即失效。  
  * **群主转让**: 群主必须先将身份转让给群内其他成员，才能以普通成员身份离开。

**2.2. 凭证与供应商管理**

* **2.2.1. 凭证范围**  
  * 采用单表设计，通过 scope ('personal'/'group') 和 scope\_id (user\_id/group\_id) 字段区分凭证归属。  
* **2.2.2. 凭证安全模型：“清空并替换”**  
  * **一次写入**: API Key等敏感信息在保存后，任何人都无法再次查看其明文。  
  * **可维护性**: 用户在编辑配置时，可通过“清空”或“替换”操作，输入全新的API Key来更新凭证。  
* **2.2.3. 编辑权限**  
  * 采用**宽松模式**：群组内的任何管理员，都有权编辑该群组下任何供应商凭证的非敏感信息（如模型温度等）。

**2.3. 核心用户交互**

* **2.3.1. 模型选择器**  
  * 所有AI调用均通过此组件发起。  
  * 当不同来源（个人、群组A、群组B）的凭证可访问同一模型时，UI上将明确展示为多个独立选项，如：“个人 \- OpenAI \- GPT-4o”、“市场部群组 \- OpenAI \- GPT-4o”。  
* **2.3.2. 用户驱动路由**  
  * 平台不进行任何自动的成本或故障转移路由。所有模型和供应商的选择权完全交由用户。  
  * 系统会记忆用户上一次的选择作为下一次的默认项。

**2.4. 成本与配额管理**

* **2.4.1. 成本展示**  
  * 向用户同时展示 Token 数量和估算的 金额。  
  * 管理员可查看其群组的总消费，并能下钻到每个成员使用该群组资源的明细。  
* **2.4.2. 配额系统**  
  * 支持为个人和群组供应商凭证设置消费上限。  
  * 达到预设百分比时进行**告警**（平台内通知），达到100%时**暂停服务**（熔断）。

**2.5. 记忆服务**

* 完全与 user\_id 绑定，为用户个人私有，上下文不跨用户或群组共享。

#### **第三部分：平台治理与数据策略**

**3.1. 超级管理员干预权**

* 在紧急情况下，拥有对群组的“冻结”权限。  
* 被冻结的群组若在14天内未解冻，将被系统自动删除。

**3.2. 群组解散策略**

* 解散时，立即删除群组、成员关系和关联凭证。  
* 相关消费记录保留14天，仅对超级管理员可见，之后**永久删除**。  
* **架构师备注**: 此为V1.0的简化决策。项目所有者已确认并接受因数据保留期过短可能带来的潜在审计风险。

#### **第四部分：技术实现规范**

**4.1. 动态计费服务**

* **必须**建立独立的 pricing\_models 数据库表，由超级管理员在后台维护。  
* 支持“从URL一键更新”的半自动化功能，并具备手动维护作为备用方案。

**4.2. API设计与错误处理**

* **必须**遵循RESTful风格，并对API进行版本控制 (/api/v1/...)。  
* **必须**采用JWT进行身份验证。  
* **必须**提供统一的JSON错误响应格式，其中包含语言中立的 code 和便于V1.0使用的中文 message。

**4.3. 性能与数据一致性**

* **必须**为数据库查询的关键字段建立索引。  
* V1.0版本**暂不引入**缓存策略，作为未来性能优化点。  
* 所有多步数据操作（用户注册、群组操作等）**必须**使用数据库事务。

**4.4. 配置与安全**

* **必须**通过环境变量 (.env 文件) 管理所有配置及密钥，严禁硬编码。  
* **必须**建立合理的日志记录策略（分级、结构化JSON）。  
* **必须**实施基础的安全措施，包括但不限于：API速率限制、所有用户输入的严格验证。